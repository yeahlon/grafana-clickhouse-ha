global
    log stdout format raw local0
    maxconn 4096
    daemon

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    option  http-server-close
    option  forwardfor except 127.0.0.0/8
    option  redispatch
    retries 3
    timeout connect 5s
    timeout client  50s
    timeout server  50s
    timeout http-request 10s
    timeout http-keep-alive 10s

# Statistics page
listen stats
    bind *:8404
    mode http
    stats enable
    stats uri /stats
    stats refresh 10s
    stats admin if TRUE
    stats auth admin:admin

# Grafana frontend
frontend grafana_frontend
    bind *:3000
    mode http
    default_backend grafana_backend

# Grafana backend pool
backend grafana_backend
    mode http
    balance roundrobin
    option httpchk GET /api/health
    http-check expect status 200
    
    # Health check configuration
    default-server inter 3s fall 3 rise 2
    
    # Grafana instances
    server grafana-1 grafana-1:3000 check
    server grafana-2 grafana-2:3000 check
    server grafana-3 grafana-3:3000 check
